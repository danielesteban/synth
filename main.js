!function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function i(t){t.forEach(e)}function o(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function r(t,e){t.appendChild(e)}function a(t,e,n){t.insertBefore(e,n||null)}function c(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function l(){return t=" ",document.createTextNode(t);var t}function d(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}let h;function m(t){h=t}function p(t){(function(){if(!h)throw new Error("Function called outside component initialization");return h})().$$.on_mount.push(t)}const f=[],g=[],y=[],x=[],v=Promise.resolve();let $=!1;function w(t){y.push(t)}const T=new Set;let b=0;function A(){const t=h;do{for(;b<f.length;){const t=f[b];b++,m(t),M(t.$$)}for(m(null),f.length=0,b=0;g.length;)g.pop()();for(let t=0;t<y.length;t+=1){const e=y[t];T.has(e)||(T.add(e),e())}y.length=0}while(f.length);for(;x.length;)x.pop()();$=!1,T.clear(),m(t)}function M(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(w)}}const _=new Set;function z(t,e){t&&t.i&&(_.delete(t),t.i(e))}function E(t,e,n,i){if(t&&t.o){if(_.has(t))return;_.add(t),undefined.c.push((()=>{_.delete(t),i&&(n&&t.d(1),i())})),t.o(e)}else i&&i()}function k(t){t&&t.c()}function V(t,n,s,r){const{fragment:a,on_mount:c,on_destroy:u,after_update:l}=t.$$;a&&a.m(n,s),r||w((()=>{const n=c.map(e).filter(o);u?u.push(...n):i(n),t.$$.on_mount=[]})),l.forEach(w)}function q(t,e){const n=t.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function C(t,e){-1===t.$$.dirty[0]&&(f.push(t),$||($=!0,v.then(A)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function P(e,o,s,r,a,u,l,d=[-1]){const p=h;m(e);const f=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(p?p.$$.context:[])),callbacks:n(),dirty:d,skip_bound:!1,root:o.target||p.$$.root};l&&l(f.root);let g=!1;if(f.ctx=s?s(e,o.props||{},((t,n,...i)=>{const o=i.length?i[0]:n;return f.ctx&&a(f.ctx[t],f.ctx[t]=o)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](o),g&&C(e,t)),n})):[],f.update(),g=!0,i(f.before_update),f.fragment=!!r&&r(f.ctx),o.target){if(o.hydrate){const t=function(t){return Array.from(t.childNodes)}(o.target);f.fragment&&f.fragment.l(t),t.forEach(c)}else f.fragment&&f.fragment.c();o.intro&&z(e.$$.fragment),V(e,o.target,o.anchor,o.customElement),A()}m(p)}class L{$destroy(){q(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const S=[2,4,8,16,32,64,128,256,512],G=new Map;class F{constructor({context:t,filters:e,gain:n=1,muted:i=!1}){this.context=t,this.output=t.createGain(),this.output.gain.setValueAtTime(i?0:n,t.currentTime),e?(this.filters=e.map((({type:e,amount:n,detune:i,frequency:o,gain:s,Q:r})=>{let a;switch(e){case"analyser":a=(t=>{const e=t.createAnalyser();e.fftSize=4096;const n=new Uint8Array(e.frequencyBinCount),i=new Uint8Array(8);return e.getBands=()=>{e.getByteFrequencyData(n);let t=0,o=0;const s=S.length-1;for(let e=0;e<s;e+=1){t=0,o=0;for(let i=S[e];i<=S[e+1];i+=1)t+=1,o+=n[i];i[e]=o/t}return i},e})(t);break;case"distortion":a=t.createWaveShaper(),a.curve=(t=>{let e=G.get(t);if(!e){const n=Math.PI/180,i=44100;e=new Float32Array(i);for(let o=0;o<i;o+=1){const s=2*o/i-1;e[o]=(3+t)*s*20*n/(Math.PI+t*Math.abs(s))}G.set(t,e)}return e})(n),a.oversample="4x";break;default:a=t.createBiquadFilter(),a.type=e,void 0!==i&&a.detune.setValueAtTime(i,t.currentTime),void 0!==o&&a.frequency.setValueAtTime(o,t.currentTime),void 0!==s&&a.gain.setValueAtTime(s,t.currentTime),void 0!==r&&a.Q.setValueAtTime(r,t.currentTime)}return a})),this.filters.forEach(((t,e)=>{e>0?this.filters[e-1].connect(t):this.input=t,e===this.filters.length-1&&t.connect(this.output)}))):this.input=this.output,this._gain=n,this._muted=i}get gain(){return this._gain}set gain(t){this._gain!==t&&(this._gain=t,this.updateGain())}get muted(){return this._muted}set muted(t){this._muted!==t&&(this._muted=t,this.updateGain())}updateGain(){const{context:t,gain:e,muted:n,output:i}=this,o=n?0:e;i.gain.cancelScheduledValues(0),i.gain.linearRampToValueAtTime(o,t.currentTime+.02)}}let B=null,R=null;const D=[],O=()=>{window.removeEventListener("keydown",O),window.removeEventListener("mousedown",O),B=new window.AudioContext,R=new F({context:B,filters:[{type:"analyser"}],gain:.5}),R.analyser=R.filters[0],R.output.connect(B.destination),document.addEventListener("visibilitychange",(()=>{R.muted="visible"!==document.visibilityState})),D.forEach((t=>t({context:B,output:R}))),D.length=0};window.addEventListener("keydown",O,!1),window.addEventListener("mousedown",O,!1);var H=()=>B?Promise.resolve({context:B,output:R}):new Promise((t=>D.push(t)));function I(e){let n;return{c(){n=u("canvas")},m(t,i){a(t,n,i),e[3](n)},p:t,i:t,o:t,d(t){t&&c(n),e[3](null)}}}function j(t,e,n){let i,o,s,{simulation:r}=e;const a=()=>{const t=window.devicePixelRatio||1,e=window.innerWidth-32,s=window.innerHeight-112;let a;a=e/s>r.size.x/r.size.y?s/r.size.y:e/r.size.x,n(0,i.width=Math.floor(r.size.x*a*t),i),n(0,i.height=Math.floor(r.size.y*a*t),i),n(0,i.style.width=r.size.x*a+"px",i),n(0,i.style.height=r.size.y*a+"px",i),o.scale(a*t,a*t)};return p((()=>{o=i.getContext("2d"),s=new Path2D;for(let t=0;t<=r.size.y;t+=16)s.moveTo(0,t-.5),s.lineTo(r.size.x,t);for(let t=0;t<=r.size.x;t+=16)s.moveTo(t,0),s.lineTo(t,r.size.y);window.addEventListener("resize",a),a()})),t.$$set=t=>{"simulation"in t&&n(1,r=t.simulation)},[i,r,()=>{o.clearRect(0,0,r.size.x,r.size.y),o.lineWidth=.3,o.strokeStyle="hsl(0, 0%, 10%)",o.stroke(s),o.lineWidth=2,r.dots.forEach((({color:t,position:e,scale:n,hit:i})=>{o.fillStyle=`hsl(${360*t}, 60%, ${50+50*i}%)`,o.strokeStyle=`hsl(${360*t}, 60%, 40%)`,o.beginPath(),o.arc(e.x,e.y,n,0,2*Math.PI),o.fill(),o.beginPath(),o.arc(e.x,e.y,n-1,0,2*Math.PI),o.stroke()}))},function(t){g[t?"unshift":"push"]((()=>{i=t,n(0,i)}))}]}class W extends L{constructor(t){super(),P(this,t,j,I,s,{simulation:1,draw:2})}get draw(){return this.$$.ctx[2]}}class N{constructor({count:t,size:e}){this.dots=Array.from({length:t},((t,n)=>{const i=1+2*Math.random(),o=4+3*i,s={x:Math.random()-.5,y:Math.random()-.5},r=Math.sqrt(s.x**2+s.y**2);return s.x/=r,s.y/=r,{color:n/7%1,hit:0,note:n,duration:.5*i,position:{x:o+Math.random()*(e.x-2*o),y:o+Math.random()*(e.y-2*o)},scale:o,direction:s,speed:5*(4-i)}})),this.size=e;for(let t=0;t<100;t++)this.step(1/60)}hit(t){const{onHit:e}=this;e&&t.hit<.5&&e(t),t.hit=1}step(t){const{dots:e,size:n}=this,i=e.length;for(let o=0;o<i;o++){const s=e[o];s.position.x+=s.direction.x*s.speed*t,s.position.y+=s.direction.y*s.speed*t,(s.position.x<s.scale||s.position.x>n.x-s.scale)&&(s.position.x=Math.min(Math.max(s.position.x,s.scale),n.x-s.scale),s.direction.x*=-1,this.hit(s)),(s.position.y<s.scale||s.position.y>n.y-s.scale)&&(s.position.y=Math.min(Math.max(s.position.y,s.scale),n.y-s.scale),s.direction.y*=-1,this.hit(s));for(let t=o+1;t<i;t++){const n=e[t],i=s.position.x-n.position.x,o=s.position.y-n.position.y,r=Math.sqrt(i**2+o**2);r<=s.scale+n.scale&&(s.direction.x=i/r,s.direction.y=o/r,this.hit(s),n.direction.x=-s.direction.x,n.direction.y=-s.direction.y,this.hit(n))}s.hit=Math.max(s.hit-2*t,0)}}}function Q(e){let n,i;return{c(){n=u("div"),i=u("canvas"),d(n,"class","analyser svelte-1hhola2")},m(t,o){a(t,n,o),r(n,i),e[1](i)},p:t,i:t,o:t,d(t){t&&c(n),e[1](null)}}}function U(t,e,n){let i,o,s;H().then((t=>{s=t.output}));const r=()=>{if(requestAnimationFrame(r),!s)return;const t=s.analyser.getBands();o.clearRect(0,0,128,36),t.forEach(((t,e)=>{const n=t/255*7;for(let t=0;t<7;t++)o.fillStyle=n>t?"#eee":"#666",o.fillRect(16*e+2,36-5*(t+1),12,4)}))};return p((()=>{o=i.getContext("2d"),n(0,i.width=128,i),n(0,i.height=36,i),requestAnimationFrame(r)})),[i,function(t){g[t?"unshift":"push"]((()=>{i=t,n(0,i)}))}]}class J extends L{constructor(t){super(),P(this,t,U,Q,s,{})}}class K{constructor({context:t,gain:e=0,note:n,waves:i}){this.context=t,this.output=t.createGain(),this.output.gain.setValueAtTime(e,t.currentTime),this.oscillators=i.map((({type:e,offset:o})=>{const s=t.createGain();s.gain.setValueAtTime(1/i.length*.5,t.currentTime),s.connect(this.output);const r=t.createOscillator();return r.type=e,r.frequency.setValueAtTime((t=>2**((t-69)/12)*440)(n+o),t.currentTime),r.connect(s),r.start(t.currentTime),r}))}trigger(t){const{context:e,output:n}=this;n.gain.cancelScheduledValues(0),n.gain.linearRampToValueAtTime(1,e.currentTime+.02),n.gain.linearRampToValueAtTime(0,e.currentTime+t)}}function X(e){let n,i,o,s,h,m,p,f,g,y,x,v,$,w,T;return w=new J({}),{c(){n=u("div"),i=u("div"),o=u("div"),o.textContent=`${e[0]}`,s=l(),h=u("div"),h.textContent="Root",m=l(),p=u("div"),f=u("div"),g=u("div"),g.textContent=`${e[1].name}`,y=l(),x=u("div"),x.textContent="Scale",v=l(),$=u("div"),k(w.$$.fragment),d(o,"class","svelte-spc5pt"),d(h,"class","svelte-spc5pt"),d(i,"class","box svelte-spc5pt"),d(g,"class","svelte-spc5pt"),d(f,"class","svelte-spc5pt"),d(x,"class","svelte-spc5pt"),d(p,"class","box svelte-spc5pt"),d($,"class","analyser svelte-spc5pt"),d(n,"class","synth svelte-spc5pt")},m(t,e){a(t,n,e),r(n,i),r(i,o),r(i,s),r(i,h),r(n,m),r(n,p),r(p,f),r(f,g),r(p,y),r(p,x),r(n,v),r(n,$),V(w,$,null),T=!0},p:t,i(t){T||(z(w.$$.fragment,t),T=!0)},o(t){E(w.$$.fragment,t),T=!1},d(t){t&&c(n),q(w)}}}function Y(t,e,n){let{simulation:i}=e;const o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],s=[{name:"Aeolian",intervals:[2,1,2,2,1,2]},{name:"Locrian",intervals:[1,2,2,1,2,2]},{name:"Ionian",intervals:[2,2,1,2,2,2]},{name:"Dorian",intervals:[2,1,2,2,2,1]},{name:"Phrygian",intervals:[1,2,2,2,1,2]},{name:"Lydian",intervals:[2,2,2,1,2,2]},{name:"Mixolydian",intervals:[2,2,1,2,2,1]},{name:"Melodic ascending minor",intervals:[2,1,2,2,2,2]},{name:"Phrygian raised sixth",intervals:[1,2,2,2,2,2]},{name:"Lydian raised fifth",intervals:[2,2,2,2,1,2]},{name:"Major minor",intervals:[2,2,1,2,1,2]},{name:"Altered",intervals:[1,2,1,2,2,2]}].map((({name:t,intervals:e})=>({name:t,intervals:e.reduce(((t,e,n)=>(t.push(t[n]+e),t)),[0])}))),r=o[Math.floor(Math.random()*o.length)],a=s[Math.floor(Math.random()*s.length)],c=[{type:"sawtooth",offset:0},{type:"sine",offset:12}];let u;return H().then((({context:t,output:e})=>{const n=t.createOscillator();n.type="sine",n.start(t.currentTime),n.frequency.setValueAtTime(4,t.currentTime),n.output=t.createGain(),n.output.gain.setValueAtTime(30,t.currentTime),n.connect(n.output),u=Array.from({length:i.dots.length},((i,s)=>{const u=12*(2+Math.floor(s/7)+(s>7?1:0))+o.indexOf(r)+a.intervals[s%7],l=new K({context:t,note:u,waves:c});l.oscillators.forEach((t=>n.output.connect(t.detune)));const d=new F({context:t,filters:[{type:"bandpass",frequency:100,Q:.5},{type:"distortion",amount:128}],gain:.5});d.output.connect(e.input),l.output.connect(d.input);const h=t.createDelay();h.delayTime.setValueAtTime(.3,t.currentTime);const m=t.createGain();m.gain.setValueAtTime(.5,t.currentTime),h.connect(m),m.connect(h);const p=t.createGain();return p.gain.setValueAtTime(.2,t.currentTime),h.connect(p),p.connect(d.input),l.output.connect(h),l}))})),i.onHit=({note:t,duration:e})=>{u&&u[t].trigger(e)},t.$$set=t=>{"simulation"in t&&n(2,i=t.simulation)},[r,a,i]}class Z extends L{constructor(t){super(),P(this,t,Y,X,s,{simulation:2})}}function tt(t){let e;return{c(){e=u("div"),e.innerHTML='<div class="svelte-ux219u"><div class="svelte-ux219u"></div></div>',d(e,"class","play svelte-ux219u")},m(t,n){a(t,e,n)},d(t){t&&c(e)}}}function et(t){let e,n,i,o,s,h,m,p,f,g,y={simulation:t[2]};n=new W({props:y}),t[3](n),o=new Z({props:{simulation:t[2]}});let x=!t[0]&&tt();return{c(){e=u("div"),k(n.$$.fragment),i=l(),k(o.$$.fragment),s=l(),x&&x.c(),h=l(),m=u("div"),m.innerHTML='<a href="https://dani.gatunes.com" rel="noopener noreferrer" target="_blank" class="svelte-ux219u">dani@gatunes</a> © 2022',p=l(),f=u("a"),f.textContent="♥ Become a sponsor",d(e,"class","app svelte-ux219u"),d(m,"class","credits svelte-ux219u"),d(f,"class","ribbon svelte-ux219u"),d(f,"href","https://github.com/sponsors/danielesteban"),d(f,"data-ribbon","♥ Become a sponsor"),d(f,"rel","noopener noreferrer"),d(f,"target","_blank")},m(t,c){a(t,e,c),V(n,e,null),r(e,i),V(o,e,null),r(e,s),x&&x.m(e,null),a(t,h,c),a(t,m,c),a(t,p,c),a(t,f,c),g=!0},p(t,[i]){n.$set({}),t[0]?x&&(x.d(1),x=null):x||(x=tt(),x.c(),x.m(e,null))},i(t){g||(z(n.$$.fragment,t),z(o.$$.fragment,t),g=!0)},o(t){E(n.$$.fragment,t),E(o.$$.fragment,t),g=!1},d(i){i&&c(e),t[3](null),q(n),q(o),x&&x.d(),i&&c(h),i&&c(m),i&&c(p),i&&c(f)}}}function nt(t,e,n){let i,o=!1;H().then((()=>{n(0,o=!0)}));const s=new N({count:21,size:{x:240,y:320}});return p((()=>{let t=performance.now()/1e3;document.addEventListener("visibilitychange",(()=>{t=performance.now()/1e3}));const e=()=>{requestAnimationFrame(e);const n=performance.now()/1e3,o=Math.min(n-t,1);t=n,s.step(o),i.draw()};requestAnimationFrame(e)})),[o,i,s,function(t){g[t?"unshift":"push"]((()=>{i=t,n(1,i)}))}]}new class extends L{constructor(t){super(),P(this,t,nt,et,s,{})}}({target:document.body})}();
